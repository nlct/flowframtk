% arara: lualatex
% arara: bib2gls: { group: on, options: [ --no-warn-unknown-entry-types ] } if missing("glstex")
% arara: lualatex if changed("glstex")
% arara: bib2gls: { group: on, options: [ --no-warn-unknown-entry-types ] }
% arara: lualatex
% arara: lualatex
\documentclass[toc=listof]{scrarticle}
\usepackage[english]{tracklang}


\usepackage{fontspec}
\setmainfont{Linux Libertine O}
\usepackage{verbatim}
\usepackage
 [
    novref,
%   debug=showwrgloss
 ]{texjavahelp}

\hypersetup{colorlinks,linkcolor=blue}
\DeclareGraphicsExtensions{.png,.pdf,.tex}

\title{jdrutils}
\author{Nicola L.C. Talbot\\\href{https://www.dickimaw-books.com/}{\nolinkurl{dickimaw-books.com}}}

\InputIfFileExists{version}{}{}
\InputIfFileExists{jdrversion}{}{}
\providecommand{\jdrversion}{??}

\GlsXtrLoadResources[src={jdrutils,shared},
 \TeXJavaHelpSymbolResourceOptions
]

\GlsXtrLoadResources[src={jdrutils,shared},
 \TeXJavaHelpGlsResourceOptions
]

\providecommand{\FlowframTk}{FlowframTk}

\glsxtrnewgls{switch.jdrconverter.}{\convswitch}
\newcommand{\convswitchdef}[1]{\switchdef{jdrconverter.#1}}

\begin{document}
\maketitle
\tableofcontents

\section{Introduction}
\label{sec:intro}

\FlowframTk\ comes with some command line applications for
converting \gls+{JDR} and \gls+{AJR} files to or from other formats. This document
describes those applications.

\section{jdrinfo}
\label{sec:jdrinfo}

\appdef{jdrinfo}

The \app{jdrinfo} command line application simply displays the file
format (\gls{JDR}/\gls{AJR}) and version number for the given
file. It requires a \ext+{jdr} or \ext+{ajr} file to input.
For example:
\begin{terminal}
\app{jdrinfo} myimage.jdr
\end{terminal}
If the file is found and is a valid \gls{JDR} or \gls{AJR} file, the
format and version will be printed to STDOUT. For example:
\begin{compactcodebox}
myimage.jdr: JDR 1.4
\end{compactcodebox}

\section{jdrconverter}
\label{sec:jdrconverter}

\FlowframTk\ (and formerly \gls{JpgfDraw}) used to be supplied with
a number of command line tools to convert between specific formats:
\app{ajr2ajr} (convert from one \gls{AJR} version to another),
\app{ajr2jdr} (convert from \gls{AJR} to \gls{JDR}),
\app{ajr2tex} (convert an image in \gls{AJR} format to a \ext+{tex} file),
\app{eps2jdr} (import an image from an \ext+{eps} file and save as \gls{JDR}),
\app{jdr2ajr} (convert from \gls{JDR} to \gls{AJR}),
\app{jdr2eps} (convert an image in \gls{JDR} format to an \ext+{eps} file),
\app{jdr2png} (convert an image in \gls{JDR} format to a \ext+{png} file),
\app{jdr2svg} (convert an image in \gls{JDR} format to an \ext+{svg} file),
\app{jdr2tex} (convert an image in \gls{AJR} format to a \ext+{tex} file),
\app{svg2jdr} (import an image from an \ext+{svg} file and save as \gls{JDR}).

As from version 0.8.8, these separate tools have all been combined
into a single converter tool:

\appdef{jdrconverter}

One input file and one output file must be specified. The switches
\convswitch{in} and \convswitch{output} may be omitted but if 
\convswitch{output} is omitted then the output file must 
come after the input file. For example:
\begin{terminal}
\app{jdrconverter} \meta{infile} \convswitch{output} \meta{outfile}
\app{jdrconverter} \convswitch{in} \meta{infile} \convswitch{output} \meta{outfile}
\app{jdrconverter} \convswitch{output} \meta{outfile} \meta{infile}
\app{jdrconverter} \convswitch{output} \meta{outfile} \convswitch{in} \meta{infile}
\app{jdrconverter} \convswitch{in} \meta{infile} \meta{outfile}
\app{jdrconverter} \meta{infile} \meta{outfile}
\end{terminal}
The last two cases above can't have the output file listed before
the input file.

The options from the old \meta{fmt}\filefmt{2}\meta{fmt} conversion tools
are recognised but deprecated. For example:
\begin{terminal}
jdr2tex \shortargfmt{doc} image.jdr imagedoc.tex
\end{terminal}%
can be replaced with:
\begin{terminal}
\app{jdrconverter} \shortargfmt{doc} image.jdr imagedoc.tex
\end{terminal}%
but it's better to use:
\begin{terminal}
\app{jdrconverter} \convswitch{doc} image.jdr imagedoc.tex
\end{terminal}

If \FlowframTk's \gls{config_dir} exists, \app{jdrconverter} will
load the default settings from the \file{flowframtk.conf} file.
These settings may be overridden by the applicable command line
switches.

\subsection{Input Options}
\label{sec:input}

\convswitchdef{in}

The input file, which must be in a supported format.
Use \convswitch{list-input-formats} for a list of
recognised formats.

\convswitchdef{from}

The input file format. This may be omitted if it can be inferred
from the input file extension.
Use \convswitch{list-input-formats} for a list of
recognised formats.

\convswitchdef{in-charset}

If the input file is a text file, then \convswitch{in-charset}
may be used to identify the file encoding.
This option is ignored if the input file format is binary.

\subsection{Output Options}
\label{sec:output}

\convswitchdef{output}

The output file, which must be in a supported format.
Use \convswitch{list-output-formats} for a list of
recognised formats.

\convswitchdef{jdr-version}

If the output file format is either \gls{JDR} or \gls{AJR}, use
this version. This option is ignored for other output file formats.
Note that if \convswitch{to} is also used with a version number then
that may override this switch depending on the command line argument
order.

If no version is specified then the latest stable version is
assumed. This is currently \strong{\jdrversion}.
There may be a newer version listed in
\convswitch{list-output-formats}, but that should be considered
unstable and liable to change. Only use unstable formats for
temporary test files.

\convswitchdef{to}

The output file format. This may be omitted if it can be inferred
from the output file extension.
Use \convswitch{list-output-formats} for a list of
recognised formats.

In the case of \gls{JDR} or \gls{AJR}, the value may be
\code{\meta{format}-\meta{version}}, where \meta{format} is either
\code{JDR} or \code{AJR} and \meta{version} is
the \gls{JDR} version number. For example, \code{JDR-1.8} indicates
\gls{JDR} version 1.8. Alternatively, you can use
\convswitch{jdr-version} to specify the version number.

For example:
\begin{terminal}
\app{jdrconverter} img.ajr img.jdr
\end{terminal}%
The output format can be inferred from the \ext{jdr} extension. No
version has been specified, so this is equivalent to:
\begin{terminal}
\app{jdrconverter} \convswitch{to} JDR-\jdrversion\ img.ajr img.jdr
\end{terminal}%
or:
\begin{terminal}
\app{jdrconverter} \convswitch{to} JDR \convswitch{jdr-version} \jdrversion\ img.ajr img.jdr
\end{terminal}%
or (since \gls{JDR} can be inferred from the \ext{jdr} extension):
\begin{terminal}
\app{jdrconverter} \convswitch{jdr-version} \jdrversion\ img.ajr img.jdr
\end{terminal}%

\convswitchdef{out-charset}

If the output file is a text file, then \convswitch{out-charset}
may be used to identify the file encoding.
This option is ignored if the output file format is binary.

\convswitchdef{settings}

If the output format is \gls{JDR} or \gls{AJR}, then the
\convswitch{settings} switch indicates which settings should be
saved in the output file. The value may be one of:

\begin{deflist}
\itemtitle{\optfmt{none}}
\begin{itemdesc}
Don't save any settings (not even the paper size).
\end{itemdesc}

\itemtitle{\optfmt{all}}
\begin{itemdesc}
Save all settings.
\end{itemdesc}

\itemtitle{\optfmt{paper}}
\begin{itemdesc}
Only save the paper size.
\end{itemdesc}

\itemtitle{\optfmt{match-input}}
\begin{itemdesc}
If the input file contained settings, save those settings.
\end{itemdesc}
\end{deflist}

\convswitchdef{export-latex}

When exporting to a \LaTeX\ (\ext+{tex}) file, this option indicates
what content should be written to the file. This option is ignored
if the output file is not a \LaTeX\ file.
The value may be one of:
\begin{deflist}
\itemtitle{\optfmt{pgf}}
\begin{itemdesc}
Just save the \env{pgfpicture} environment that draws the image.
The \ext{tex} file is intended to be \gls{input} in another file.
\end{itemdesc}

\itemtitle{\optfmt{doc}}
\begin{itemdesc}
Create a complete standalone document that contains a
\env{pgfpicture} environment in the \gls{document-body} that draws the image.
If used with \convswitch{crop} then the document \gls{paper} size will be set
to the image's \gls{image.bbox}, otherwise the paper size in the input
file settings will be used.

If the input image included a \gls{document-class}, this will be used
otherwise the default setting will be used. The
\gls{normal-font-size} will either be obtained from the input image
or from \convswitch{normalsize}.

The document will automatically include the code to load the
\sty{pgf} package.
If the input image contains any \gls{early-preamble}, 
\gls{mid-preamble} or \gls{late-preamble} code, this will be added
to the document preamble in the corresponding places.
\end{itemdesc}

\itemtitle{\optfmt{flow}}
\begin{itemdesc}
Create a complete standalone document that loads the \sty{flowfram}
package and sets up the \gls{typeblock}, flow frames, static frames
and dynamic frames defined in the input file.

\begin{important}
An error will occur if the input file does not provide any 
\gls{flowframe} data.
Any \glspl{object} in the image that don't have \gls{flowframe} data
assigned will be omitted.
\end{important}

If the input image included a \gls{document-class}, this will be used
otherwise the default setting will be used. The
\gls{normal-font-size} will either be obtained from the input image
or from \convswitch{normalsize}.

The document will automatically include the code to load the
\sty{pgf} and \sty{flowfram} packages.
If the input image contains any \gls{early-preamble}, 
\gls{mid-preamble} or \gls{late-preamble} code, this will be added
to the document preamble in the corresponding places.

If the input image contains a \gls{document-body}, this code
will be placed in the \env{document} environment, otherwise
the minimum number of required pages will be calculated
and the appropriate number of \gls{null} and \gls{clearpage}
commands will be placed in the
\env{document} environment to ensure that number of pages are
generated.

\end{itemdesc}

\end{deflist}

\convswitchdef{doc}

A shortcut for \code{\convswitch{export-latex} doc}.

\convswitchdef{normalsize}

Set the default \gls{normal-font-size} to \meta{n}.
This option may be overridden if the input file contains a 
\gls{normal-font-size} setting.
It's intended for input files that don't contain
a \gls{normal-font-size} value.

\convswitchdef{crop}

For output formats that support cropping, crop the image
either to its \gls{image.bbox} or (if \convswitch{use-typeblock})
to the \gls{typeblock}.
This option is ignored for output formats that don't support
cropping.

\convswitchdef{use-typeblock}

If the \convswitch{crop} option is applied then use the
\gls{typeblock} rather than the image's \gls{image.bbox}
for the cropped area. The input file will need to have 
a \gls{typeblock} identified.
This option is ignored for output formats that don't support
cropping.

\convswitchdef{no-use-typeblock}

Don't use the \gls{typeblock} when determining the cropped area.
This option is ignored for output formats that don't support
cropping.

\convswitchdef{use-flowframtksty}

Assume that the \sty{flowframtk} package is installed and use that
package instead of writing all the internal command definitions.
Only applicable if exporting to a \LaTeX\ format, such as creating a
package, class, \sty{pgf} image or document file or a format that's
derived from a temporary \LaTeX\ file.

\begin{information}
The \sty{flowframtk} package is a supplementary package provided
with the \sty{flowfram} package (v1.18+) specifically for use
with \FlowframTk. If you have an older version of \sty{flowfram}
installed, the \sty{flowframtk} package won't be available.
\end{information}

\convswitchdef{no-use-flowframtksty}

The \sty{flowframtk} package isn't installed 
so write all the internal command definitions to support the
required export features.

\convswitchdef{alpha}

Include the alpha channel (transparency) when exporting to
\ext+{png} files.
This option is ignored for other output formats.

\convswitchdef{no-alpha}

Don't include the alpha channel (transparency) when exporting to
\ext+{png} files.
This option is ignored for other output formats.

\convswitchdef{bitmaps-to-eps}

Convert any \glspl{bitmap} found in the input
file to \ext+{eps} files (if they don't already exist).
This option is designed for use when \convswitch{use-latex} is on
and the \LaTeX\ engine used requires DVI output.

\convswitchdef{no-bitmaps-to-eps}

Don't convert any \glspl{bitmap}.

\convswitchdef{use-latex}

Use \LaTeX\ (and friends) to create the output file (if supported).
This option will be ignored if the output format always requires
or never requires external processes.

For example, if the output format is PDF, then \pdfLaTeX\ must be
used, but if the output format is \gls{JDR} or \gls{AJR} then 
no external processes are required. In both these cases, the
\convswitch{use-latex} option is ignored as there's no choice.

However, if the output format is EPS or SVG then you can choose
whether or not to use external tools.

\convswitchdef{no-use-latex}

Don't use \LaTeX\ (and friends) to create the output file (if
the output file can be created without any external processes).

\convswitchdef{latex-dvi}

If an external process is required to use a \LaTeX\ engine that creates DVI
output, this option identifies the path to the \app{latex} application.

\convswitchdef{latex-pdf}

If an external process is required to use a \LaTeX\ engine that
creates PDF output, this option identifies the path to the
\app{pdflatex} application.

\convswitchdef{dvips}

If an external process is required that needs to convert DVI to
PostScript, this option identifies the path to the \app{dvips} application.

\convswitchdef{dvisvgm}

If an external process is required that needs to convert DVI to SVG, 
this option identifies the path to the \app{dvisvgm} application.

\convswitchdef{libgs}

If you need to use \app{dvisvgm} then you can additionally identify
the path to the \file{libgs} library.


\subsection{Other Options}
\label{sec:other}

\convswitchdef{list-input-formats}

List all recognised input formats and exit.

\convswitchdef{list-output-formats}

List all recognised output formats and exit.

\convswitchdef{help}

Prints syntax help and exits.

\convswitchdef{version}

Prints the application version information and exits.

\convswitchdef{verbose}

Enable verbose mode.

\convswitchdef{no-verbose}

Disable verbose mode (default).
Errors and warnings will still be printed to STDERR.

\convswitchdef{quiet}

Silent mode.

\convswitchdef{debug}

Enable debugging mode.
This will override the verbose or silent mode settings.

\convswitchdef{no-debug}

Disable debugging mode (default).

\listentrydescendents
 [title={Summary of \apptext{jdrconverter} Switches}]
 {app.jdrconverter}

\printmain
\printindex 

\end{document} 

